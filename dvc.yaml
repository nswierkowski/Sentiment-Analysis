stages:
  raw_data_processing:
    cmd: python scripts/raw_data_processing.py ./data/raw ./data/processed/reviews.csv 
    params:
      - raw_data_processing.colums_not_to_keep
    deps:
      - scripts/raw_data_processing.py
      - data/raw
    outs:
      - data/processed/reviews.csv

  execute_notebook:
    cmd: papermill notebooks/exploratory_analysis.ipynb data/processed/exploratory_analysis.ipynb
    deps:
      - notebooks/exploratory_analysis.ipynb
      - data/processed/reviews.csv
    outs:
      - data/processed/exploratory_analysis.ipynb:
          cache: false

  split:
    cmd: python scripts/split_processed_data.py ./data/processed/reviews.csv ./data/splitted ${split.test_size} ${split.stratify}
    deps:
      - scripts/split_processed_data.py
      - ./data/processed/reviews.csv
    outs:
      - ./data/splitted/X_train.csv
      - ./data/splitted/y_train.csv
      - ./data/splitted/X_test.csv
      - ./data/splitted/y_test.csv

  clean_data:
    cmd: python3 scripts/clean_data.py ./data/splitted ./data/cleaned ./params.yaml
    deps:
      - scripts/clean_data.py
      - ./data/splitted/X_train.csv
      - ./data/splitted/y_train.csv
      - ./data/splitted/X_test.csv
      - ./data/splitted/y_test.csv
      - params.yaml
    outs:
      - data/cleaned/X_train_cleaned.csv
      - data/cleaned/y_train_cleaned.csv
      - data/cleaned/X_test_cleaned.csv
      - data/cleaned/y_test_cleaned.csv

  validate:
    cmd: python3 scripts/validate.py ./data/cleaned ./data/validate ./params.yaml
    deps:
      - scripts/validate.py
      - data/cleaned/X_train_cleaned.csv
      - data/cleaned/y_train_cleaned.csv
      - data/cleaned/X_test_cleaned.csv
      - data/cleaned/y_test_cleaned.csv
      - params.yaml
    outs:
      - data/validate/cv_metrics_all_modes.csv

  train:
    cmd: python scripts/train.py ./data/cleaned ./data/validate/cv_metrics_all_modes.csv ./params.yaml ./metrics.json
    deps:
      - scripts/train.py
      - data/cleaned/X_test_cleaned.csv
      - data/cleaned/y_test_cleaned.csv
      - params.yaml
    metrics:
      - metrics.json